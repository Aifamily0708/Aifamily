<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 å°å—è–èª•æ˜Ÿå…‰åœ°åœ–</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: "Noto Sans TC", sans-serif;
            background-color: #0f1c3f;
            color: #fff;
            overflow: hidden;
        }

        /* --- æ¨™é¡Œå€åŸŸ --- */
        #header {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            padding: 8px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            text-align: center;
            border: 3px solid #c41e3a;
            min-width: 260px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            margin: 0;
            color: #c41e3a;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }

        p.subtitle {
            margin: 2px 0 0 0;
            color: #2c5e1a;
            font-weight: 700;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        /* --- åœ°åœ–å®¹å™¨ --- */
        #map {
            height: calc(100% - 70px); /* æ‰£é™¤åº•éƒ¨ Footer é«˜åº¦ */
            width: 100%;
            background: #cdcdcd;
        }

        /* --- å¯ç¸®æ”¾åœ–ç¤ºèªªæ˜ (Legend) --- */
        #legend {
            position: absolute;
            bottom: 90px; /* ä½æ–¼ Footer ä¸Šæ–¹ */
            right: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            z-index: 1000;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-size: 0.85rem;
            border-left: 5px solid #c41e3a;
            width: 180px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        /* æ”¶åˆç‹€æ…‹ */
        #legend.collapsed {
            width: 140px;
        }
        #legend.collapsed .legend-items {
            max-height: 0;
            padding-bottom: 0;
            opacity: 0;
        }
        #legend.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .legend-header {
            padding: 10px 15px;
            font-weight: bold;
            color: #0f1c3f;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }
        .legend-header:hover {
            background: #eee;
        }
        .toggle-icon {
            transition: transform 0.3s ease;
            color: #c41e3a;
        }

        .legend-items {
            padding: 10px 15px;
            max-height: 200px; /* å±•é–‹é«˜åº¦ */
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .legend-item:last-child {
            margin-bottom: 0;
        }
        .legend-icon {
            width: 24px;
            text-align: center;
            margin-right: 8px;
            font-size: 1rem;
        }

        /* --- å›ºå®šåº•éƒ¨è³‡è¨Šæ¬„ (Footer) --- */
        #footer-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background: rgba(15, 28, 63, 0.95); /* æ·±è—è‰²èƒŒæ™¯ */
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            border-top: 3px solid #c41e3a;
            color: #fff;
        }

        .footer-left {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.8rem;
        }
        
        .footer-link {
            color: #ddd;
            text-decoration: none;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .footer-link:hover {
            color: #fff;
            text-decoration: underline;
        }

        .copyright {
            color: #888;
            font-size: 0.75rem;
        }

        .footer-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .social-label {
            font-size: 0.9rem;
            font-weight: bold;
            margin-right: 5px;
            display: none; /* æ‰‹æ©Ÿç‰ˆéš±è—æ–‡å­— */
        }
        @media (min-width: 600px) {
            .social-label { display: block; }
        }

        .social-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: transform 0.2s;
            background: #444;
            font-size: 1.2rem;
        }
        .social-btn:hover {
            transform: scale(1.15);
        }
        .social-fb { background: #1877F2; }
        .social-ig { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); }
        .social-yt { background: #FF0000; }


        /* --- å½ˆå‡ºè¦–çª— (Popup) --- */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 3px 14px rgba(0,0,0,0.4);
        }
        .leaflet-popup-content {
            margin: 0;
            width: 280px !important;
        }
        .popup-header {
            background: #c41e3a;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .popup-body {
            padding: 12px 15px;
            background: #fff;
            color: #333;
        }
        .popup-desc {
            font-size: 0.95rem;
            margin-bottom: 10px;
            line-height: 1.5;
            color: #444;
        }
        .popup-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        .popup-tag {
            background: #f0f2f5;
            color: #555;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            border: 1px solid #e1e4e8;
        }
        .popup-tag.activity {
            background: #fff0f0;
            color: #c41e3a;
            border-color: #ffcccc;
            font-weight: bold;
        }
        .popup-footer {
            padding: 10px 15px;
            background: #f9f9f9;
            border-top: 1px solid #eee;
            text-align: right;
        }
        .nav-btn {
            display: inline-block;
            background: #c41e3a;
            color: #ffffff !important;
            text-decoration: none;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: bold;
            transition: background 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .nav-btn:hover {
            background: #a01830;
            color: #ffffff !important;
        }

        /* --- Marker Styles --- */
        .marker-pin {
            width: 36px;
            height: 36px;
            border-radius: 50% 50% 50% 0;
            position: absolute;
            transform: rotate(-45deg);
            left: 50%;
            top: 50%;
            margin: -18px 0 0 -18px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid white;
        }
        .marker-pin i {
            transform: rotate(45deg);
            font-size: 1rem;
            color: white;
        }

        .bg-red { background: #c41e3a; }
        .bg-green { background: #2c5e1a; }
        .bg-gold { background: #d4af37; }
        .bg-blue { background: #0066cc; }

        .pulse-ring {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(196, 30, 58, 0.4);
            animation: pulse 2s infinite;
            position: absolute;
            z-index: -1;
            transform: rotate(45deg);
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.6); opacity: 0; }
        }

        /* --- Snow Effect --- */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #fff;
            user-select: none;
            pointer-events: none;
            z-index: 9999;
        }
        /* Mobile adjust */
        @media (max-width: 480px) {
            #legend { bottom: 80px; right: 10px; }
            .footer-left { max-width: 150px; }
            .footer-link span { display: none; } /* Hide link text if too narrow, keep icon */
            .footer-link::after { content: " è³‡æ–™ä¾†æº"; display: inline; }
        }
    </style>
</head>
<body>

    <div id="header">
        <h1><i class="fa-solid fa-tree" style="color:#2c5e1a;"></i> è–èª•æ˜Ÿå…‰ å–œæ¨‚æ»¿åŸ</h1>
        <p class="subtitle">TAINAN CHRISTMAS 2025</p>
    </div>

    <div id="map"></div>

    <!-- å¯ç¸®æ”¾åœ–ç¤ºèªªæ˜ -->
    <div id="legend">
        <div class="legend-header" onclick="toggleLegend()">
            <span><i class="fa-solid fa-layer-group"></i> åœ–ç¤ºèªªæ˜</span>
            <i class="fa-solid fa-chevron-down toggle-icon"></i>
        </div>
        <div class="legend-items">
            <div class="legend-item">
                <div class="legend-icon" style="color: #c41e3a;"><i class="fa-solid fa-star"></i></div>
                <span>å®˜æ–¹é‡é»ç‡ˆå€</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon" style="color: #2c5e1a;"><i class="fa-solid fa-church"></i></div>
                <span>æ•™æœƒ/æ•™å ‚é»ç‡ˆ</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon" style="color: #d4af37;"><i class="fa-solid fa-gift"></i></div>
                <span>ç™¾è²¨/å•†åœˆ</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon" style="color: #0066cc;"><i class="fa-solid fa-location-dot"></i></div>
                <span>è§€å…‰æ™¯é»</span>
            </div>
        </div>
    </div>

    <!-- å›ºå®šåº•éƒ¨è³‡è¨Šæ¬„ -->
    <div id="footer-bar">
        <div class="footer-left">
            <a href="https://www.twtainan.net/zh-tw/event/activitydetail/7632/" target="_blank" class="footer-link">
                <i class="fa-solid fa-circle-info"></i> <span>2025å°å—è–èª•ç‡ˆç¯€æ´»å‹•å®˜ç¶²</span>
            </a>
            <span class="copyright">Â© 2025 AIè¦ªå­æˆé•·å±‹ å½™æ•´è£½ä½œ</span>
        </div>
        
        <div class="footer-right">
            <span class="social-label">AIè¦ªå­æˆé•·å±‹</span>
            <a href="https://www.facebook.com/profile.php?id=61579308823985" target="_blank" class="social-btn social-fb" title="Facebook"><i class="fa-brands fa-facebook-f"></i></a>
            <a href="https://www.instagram.com/aifamily0708?igsh=MXdlbzFsaTYxMDhidw%3D%3D&utm_source=qr" target="_blank" class="social-btn social-ig" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
            <a href="https://www.youtube.com/@aifamily0708" target="_blank" class="social-btn social-yt" title="YouTube"><i class="fa-brands fa-youtube"></i></a>
        </div>
    </div>

    <div id="snow-container"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // åˆå§‹åŒ–åœ°åœ–
        const map = L.map('map', {
            zoomControl: false 
        }).setView([23.05, 120.22], 10); // èª¿æ•´è¦–è§’ä»¥æ¶µè“‹å¤§å°å—

        // å°‡ç¸®æ”¾æ§åˆ¶é …ç§»åˆ°å³ä¸Šè§’ï¼Œé¿å…èˆ‡åº•éƒ¨ Footer é‡ç–Š
        L.control.zoom({
            position: 'topright'
        }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);

        // åœ–ç¤ºèªªæ˜ç¸®æ”¾åŠŸèƒ½
        function toggleLegend() {
            const legend = document.getElementById('legend');
            legend.classList.toggle('collapsed');
        }

        // è³‡æ–™åº« (å·²æ ¡æ­£çœŸå¯¦ç¶“ç·¯åº¦)
        const locations = [
            // --- 2025 å®˜æ–¹åå¤§ä¸»é¡Œè–èª•æ¨¹ / é‡é»ç‡ˆå€ ---
            { name: "æ°‘æ²»å¸‚æ”¿ä¸­å¿ƒå¸‚æ°‘å»£å ´", lat: 23.31135, lng: 120.31608, type: "main", icon: "fa-star", desc: "å¹¸ç¦å°å—ï¼è€¶èª•é»ç‡ˆ", area: "æ–°ç‡Ÿå€" },
            { name: "æ–°ç‡Ÿæ–‡åŒ–ä¸­å¿ƒæš¨ç¶ å·å»Šé“", lat: 23.30752, lng: 120.31456, type: "main", icon: "fa-music", desc: "è–èª•éŸ³æ¨‚æœƒ & é›²ä¹‹æ›™å…‰", area: "æ–°ç‡Ÿå€" },
            { name: "è‡ºå—å¸‚ç«‹åœ–æ›¸é¤¨æ–°ç¸½é¤¨", lat: 23.02456, lng: 120.23358, type: "main", icon: "fa-book", desc: "æ–°Â·è‡ºå—æ´¾å°ï¼šè–èª•æ¨¹é»ç‡ˆ", area: "æ°¸åº·å€" },
            { name: "æ²³æ¨‚å»£å ´", lat: 22.99351, lng: 120.19421, type: "main", icon: "fa-star", desc: "å…‰ä¹‹æ—…ç¨‹ï¼šå°å—é‹æ²³è–èª•ä¸»ç‡ˆå€", area: "ä¸­è¥¿å€" },
            { name: "æ–°å…‰ä¸‰è¶Šå°å—æ–°å¤©åœ°", lat: 22.98708, lng: 120.19830, type: "main", icon: "fa-gift", desc: "The Light of Loveï¼šæ„›çš„å…‰èŠ’ (è¥¿é–€å»£å ´)", area: "ä¸­è¥¿å€" },
            { name: "å—ç´¡è³¼ç‰©ä¸­å¿ƒ", lat: 22.99158, lng: 120.23315, type: "main", icon: "fa-gift", desc: "POP MART èŒç²’é©šå–œï¼šè˜‹å®‰ç¶»Funå¹¸ç¦ç›¸é‡ (A2é¤¨å»£å ´)", area: "æ±å€" },
            { name: "å¤§é ç™¾ æˆåŠŸåº—", lat: 22.99602, lng: 120.21105, type: "main", icon: "fa-gift", desc: "æ˜Ÿå…‰ç‡¦çˆ›è–èª•æ¨¹ (å‰é‹’è·¯å»£å ´)", area: "æ±å€" },
            // { name: "å¥‡ç¾åšç‰©é¤¨", lat: 22.93456, lng: 120.22602, type: "main", icon: "fa-music", desc: "å¥‡ç¾è–èª•é€±æœ«ï¼šå¹¸ç¦è–èª•æ¨¹", area: "ä»å¾·å€" }, // å·²ç§»é™¤
            { name: "MITSUI OUTLET PARK å°å—", lat: 22.92425, lng: 120.28612, type: "main", icon: "fa-robot", desc: "è¶…äººåŠ›éœ¸ç‹ï¼šè–èª•é€ æ™¯", area: "æ­¸ä»å€" },
            
            // æ–°å¢ä¿®æ­£ï¼šæ–°å…‰ä¸‰è¶Š å°å—å°åŒ—é–€åº— (çœŸå¯¦ä½ç½®åœ¨è¥¿é–€è·¯å››æ®µ135è™Ÿï¼ŒåŸæ±å¸å£«èˆŠå€)
            { name: "æ–°å…‰ä¸‰è¶Š å°å—å°åŒ—é–€åº—", lat: 23.01170, lng: 120.20500, type: "main", icon: "fa-train", desc: "å¹¸ç¦åˆ—è»Šï¼š12ç±³é«˜è€¶èª•æ¨¹èˆ‡å°ç«è»Š (è¥¿é–€è·¯å››æ®µ)", area: "åŒ—å€" }, 

            // --- æºªåŒ—åœ°å€ ---
            { name: "æ–°ç‡Ÿé•·è€æ•™æœƒ", lat: 23.30512, lng: 120.31225, type: "church", area: "æ–°ç‡Ÿå€" },
            { name: "é¹½æ°´å¤©ä¸»è–ç¥å ‚", lat: 23.32115, lng: 120.26620, type: "church", desc: "è‘—åä¸­å¼å®®æ®¿é¢¨æ ¼å¤©ä¸»å ‚", area: "é¹½æ°´å€" },
            { name: "ä½³é‡Œæ•™æœƒ", lat: 23.16620, lng: 120.17750, type: "church", area: "ä½³é‡Œå€" },
            { name: "éº»è±†æ©å…¸ä¹‹å®¶", lat: 23.18550, lng: 120.24880, type: "church", area: "éº»è±†å€" },
            { name: "æ¼šæ±ªé•·è€æ•™æœƒ", lat: 23.19520, lng: 120.14560, type: "church", area: "å°‡è»å€" },
            { name: "è˜­éƒ½è§€å…‰å·¥å» ", lat: 23.23560, lng: 120.33520, type: "spot", desc: "OrchidCity è˜­èŠ±è–èª•ä½ˆç½®", area: "å…­ç”²å€" },

            // --- å±±å€èˆ‡å—ç§‘å‘¨é‚Š ---
            { name: "å–„åŒ–è–å®¶å¤©ä¸»å ‚", lat: 23.13320, lng: 120.29450, type: "church", area: "å–„åŒ–å€" },
            { name: "å—ç§‘è´Šç¾é…’åº—", lat: 23.10950, lng: 120.28420, type: "spot", icon: "fa-hotel", desc: "å¿ƒä¹‹æ‰€å‘ï¼šæ¹–ç•”è–èª•è£ç½®", area: "å–„åŒ–å€" },
            { name: "ç‰äº•åŸºç£é•·è€æ•™æœƒ", lat: 23.12450, lng: 120.46080, type: "church", area: "ç‰äº•å€" },
            { name: "å±±ä¸Šæ•™æœƒ", lat: 23.10250, lng: 120.35520, type: "church", area: "å±±ä¸Šå€" },
            { name: "å·¦é®åŸºç£é•·è€æ•™æœƒ", lat: 23.05580, lng: 120.40850, type: "church", area: "å·¦é®å€" },
            { name: "æ–°åŒ–åŸºç£é•·è€æ•™æœƒ", lat: 23.03650, lng: 120.30580, type: "church", area: "æ–°åŒ–å€" },
            { name: "æ–°å¸‚å¤©ä¸»å ‚", lat: 23.07850, lng: 120.29350, type: "church", area: "æ–°å¸‚å€" },

            // --- æ°¸åº·å€ ---
            { name: "æ°¸åº·æ³•è’‚ç‘ªè–æ¯å¤©ä¸»å ‚", lat: 23.01020, lng: 120.24550, type: "church", area: "æ°¸åº·å€" },
            { name: "æ¢ç´¢æ•™è‚²å…¬åœ’", lat: 23.01850, lng: 120.25020, type: "spot", area: "æ°¸åº·å€" },
            { name: "å°æ±è–èª•å¸‚é›†(å…‰æ˜å…¬åœ’)", lat: 22.99920, lng: 120.23550, type: "main", icon: "fa-store", area: "æ°¸åº·å€" },

            // --- å¸‚ä¸­å¿ƒ ---
            { name: "å¤ªå¹³å¢ƒé¦¬é›…å„ç´€å¿µæ•™æœƒ", lat: 22.99280, lng: 120.20480, type: "church", desc: "ç™¾å¹´æ­·å²ç™½è‰²æ•™å ‚", area: "ä¸­è¥¿å€" },
            { name: "çœ‹è¥¿è¡—æ•™æœƒ", lat: 22.99760, lng: 120.19720, type: "church", desc: "ä»¿è–ä¿ç¾…å¤§æ•™å ‚åœ“é ‚å»ºç¯‰", area: "ä¸­è¥¿å€" },
            { name: "å°å—æ°‘æ—è·¯é•·è€æ•™æœƒ", lat: 22.99710, lng: 120.20750, type: "church", area: "ä¸­è¥¿å€" },
            { name: "é–‹å±±è·¯ä¸­è¯è–æ¯ä¸»æ•™åº§å ‚", lat: 22.98820, lng: 120.20710, type: "church", desc: "ä¸­åœ‹å®®æ®¿å¼å¤©ä¸»å ‚", area: "ä¸­è¥¿å€" },
            { name: "æ—ç™¾è²¨", lat: 22.99180, lng: 120.20260, type: "spot", desc: "å¤è¹Ÿç™¾è²¨ï¼šè–èª•å¤œæ™¯", area: "ä¸­è¥¿å€" },
            { name: "æ–°å…‰ä¸‰è¶Š å°å—ä¸­å±±åº—", lat: 22.99550, lng: 120.21120, type: "mall", icon: "fa-gift", area: "ä¸­è¥¿å€" },
            { name: "å°å—ç¥å¬æœƒ", lat: 23.00520, lng: 120.21050, type: "church", area: "åŒ—å€" },
            { name: "å¤§å…‰æ•™æœƒ", lat: 23.00850, lng: 120.21580, type: "church", area: "åŒ—å€" },
            { name: "å°å—å—è–æ•™æœƒ", lat: 22.98550, lng: 120.24050, type: "church", area: "æ±å€" },
            { name: "è—æ™’åœ–æ–‡å‰µåœ’å€", lat: 22.98620, lng: 120.19750, type: "spot", desc: "æ–‡å‰µè–èª•å¸‚é›†èˆ‡ä½ˆç½®", area: "å—å€" },
            { name: "å®‰å¹³éˆç³§å ‚", lat: 22.99850, lng: 120.17550, type: "church", area: "å®‰å¹³å€" },
            { name: "å®‰å¹³æ•™æœƒ", lat: 23.00050, lng: 120.16250, type: "church", area: "å®‰å¹³å€" },
            { name: "å°å—è–æ•™æœƒ", lat: 22.99050, lng: 120.18050, type: "church", area: "å®‰å¹³å€" },

            // --- ä»å¾·/æ­¸ä» ---
            { name: "è™¹æ³°æ°´å‡è† ä¸–ç•Œ", lat: 22.97550, lng: 120.24580, type: "spot", desc: "è§€å…‰å·¥å» è–èª•ä½ˆç½®", area: "ä»å¾·å€" },
            { name: "å¥‡ç¾é£Ÿå“å¹¸ç¦å·¥å» ", lat: 22.93550, lng: 120.22550, type: "spot", area: "ä»å¾·å€" },
            { name: "æ­¸ä»æ•™æœƒ", lat: 22.96650, lng: 120.29450, type: "church", area: "æ­¸ä»å€" }
        ];

        function createCustomIcon(location) {
            let className = '';
            let iconClass = location.icon || 'fa-map-marker-alt';
            let isPulse = false;

            switch(location.type) {
                case 'main': className = 'bg-red'; isPulse = true; if (!location.icon) iconClass = 'fa-star'; break;
                case 'church': className = 'bg-green'; if (!location.icon) iconClass = 'fa-church'; break;
                case 'mall': className = 'bg-gold'; if (!location.icon) iconClass = 'fa-gift'; break;
                case 'spot': className = 'bg-blue'; break;
            }

            if (location.type === 'church') iconClass = 'fa-church';

            const pulseHtml = isPulse ? '<span class="pulse-ring"></span>' : '';
            
            return L.divIcon({
                className: 'custom-div-icon',
                html: `<div class='marker-pin ${className}'>
                        ${pulseHtml}
                        <i class='fa-solid ${iconClass}'></i>
                       </div>`,
                iconSize: [36, 36],
                iconAnchor: [18, 42],
                popupAnchor: [0, -40]
            });
        }

        locations.forEach(loc => {
            const marker = L.marker([loc.lat, loc.lng], {
                icon: createCustomIcon(loc)
            }).addTo(map);

            const typeLabel = {
                'main': 'ğŸ„ é‡é»æ´»å‹•',
                'church': 'â›ª æ•™æœƒé»ç‡ˆ',
                'mall': 'ğŸ ç™¾è²¨å•†åœˆ',
                'spot': 'âœ¨ è§€å…‰æ™¯é»'
            }[loc.type];

            // ä¿®æ­£ï¼šå°èˆªæŒ‰éˆ•ä¸å†ä½¿ç”¨ç¶“ç·¯åº¦ï¼Œè€Œæ˜¯ä½¿ç”¨ã€Œåœ°é»åç¨±ã€é€²è¡Œæœå°‹
            // é€™æ¨£ Google Maps App é–‹å•Ÿæ™‚æœƒç›´æ¥æœå°‹è©²åœ°æ¨™ï¼Œæä¾›æ›´æº–ç¢ºçš„å°èˆªé«”é©—
            const searchTerm = encodeURIComponent(loc.name + " " + (loc.area || "å°å—"));
            const googleMapUrl = `https://www.google.com/maps/search/?api=1&query=${searchTerm}`;

            const popupContent = `
                <div class="popup-header">
                    <span>${loc.name}</span>
                    <i class="fa-solid ${loc.type === 'church' ? 'fa-church' : 'fa-star'}" style="opacity:0.8"></i>
                </div>
                <div class="popup-body">
                    <div class="popup-tags">
                        <span class="popup-tag ${loc.type === 'main' ? 'activity' : ''}">${typeLabel}</span>
                        ${loc.area ? `<span class="popup-tag">${loc.area}</span>` : ''}
                    </div>
                    <div class="popup-desc">
                        ${loc.desc ? loc.desc : `ä½æ–¼${loc.area || 'å°å—'}çš„è–èª•ç¯€æ…¶äº®é»ï¼Œæ­¡è¿è’è‡¨æ„Ÿå—ç¯€æ—¥æ°£æ°›ã€‚`}
                    </div>
                </div>
                <div class="popup-footer">
                    <a href="${googleMapUrl}" target="_blank" class="nav-btn">
                        <i class="fa-solid fa-location-arrow"></i> å°èˆªå»
                    </a>
                </div>
            `;

            marker.bindPopup(popupContent);
        });

        function createSnow() {
            const container = document.getElementById('snow-container');
            const snowflakesCount = window.innerWidth < 768 ? 25 : 50; 

            for (let i = 0; i < snowflakesCount; i++) {
                const snow = document.createElement('div');
                snow.className = 'snowflake';
                snow.innerHTML = 'â„';
                snow.style.left = Math.random() * 100 + '%';
                snow.style.animation = `fall ${(Math.random() * 5 + 5)}s linear infinite`;
                snow.style.animationDelay = -Math.random() * 10 + 's';
                snow.style.opacity = Math.random() * 0.7 + 0.3;
                snow.style.fontSize = (Math.random() * 10 + 10) + 'px';
                container.appendChild(snow);
            }
            
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes fall {
                    0% { transform: translateY(-10vh) translateX(-10px) rotate(0deg); }
                    100% { transform: translateY(100vh) translateX(10px) rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }

        createSnow();
    </script>
</body>
</html>
