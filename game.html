import React, { useState, useEffect } from 'react';
import { Users, Star, StarHalf, ChevronRight, Sparkles, Filter, Car, PartyPopper, TrainFront, Coffee, X, Clock, Trophy, Play, CheckCircle2, Facebook, Instagram, Youtube } from 'lucide-react';

// éŠæˆ²è³‡æ–™ (æ–°å¢ rules è©³ç´°è¦å‰‡)
const games = [
  {
    id: 1,
    title: 'ğŸ® æ­¡æ¨‚çŒœç‡ˆè¬',
    players: '3äººä»¥ä¸Š',
    difficulty: 2,
    difficultyLabel: 'è¼•é¬†å‹•è…¦',
    tags: ['å‚³çµ±å¿…å‚™', 'è€å°‘å’¸å®œ', 'ç›Šæ™º'],
    mode: ['home', 'traffic'],
    description: 'å‚³çµ±å¹´å‘³çµ•å°å°‘ä¸äº†çš„ç’°ç¯€ï¼ç”±ä¸€äººæ“”ä»»é—œä¸»æº–å‚™å„å¼ç‡ˆè¬ã€è…¦ç­‹æ€¥è½‰å½æˆ–å®¶æ—å°å…«å¦ï¼Œå…¶ä»–äººæ¶ç­”ã€‚',
    tips: 'è‹¥åœ¨è»Šä¸Šï¼Œå¯ä»¥æ”¹çŒœã€Œèˆ‡æ•¸å­—æœ‰é—œçš„æˆèªã€æˆ–ã€ŒçŒœçŒœè»Šä¸ŠæŸå€‹äººçš„ç‰¹å¾µã€ã€‚',
    rules: [
      'é¸å‡ºä¸€ä½ã€Œé—œä¸»ã€è² è²¬å‡ºé¡Œ (å¯ä¸Šç¶²æŸ¥ç‡ˆè¬æˆ–è‡ªå‰µ)ã€‚',
      'é—œä¸»å”¸å‡ºé¡Œç›®ï¼Œå…¶ä»–äººèˆ‰æ‰‹æ¶ç­”ã€‚',
      'ç­”å°è€…ç²å¾—ä¸€åˆ† (æˆ–æ˜¯ç²å¾—ä¸€é¡†ç³–æœ/ç´…åŒ…)ã€‚',
      'ç´¯ç©æœ€å¤šåˆ†è€…ç²å‹ï¼'
    ],
    tool: 'scoreboard' // å•Ÿç”¨è¨ˆåˆ†æ¿
  },
  {
    id: 6,
    title: 'ğŸš— ç˜‹ç‹‚æˆèªæ¥é¾',
    players: '2äººä»¥ä¸Š',
    difficulty: 3,
    difficultyLabel: 'æ®ºæ™‚é–“ç¥å™¨',
    tags: ['å…é“å…·', 'åæ‡‰åŠ›', 'æ•™è‚²'],
    mode: ['traffic'],
    description: 'å¡è»Šé€™æ™‚å€™æœ€é©åˆå‹•å‹•è…¦ï¼è€ƒé©—è©å½™é‡èˆ‡åæ‡‰é€Ÿåº¦ã€‚',
    tips: 'å¦‚æœæˆèªå¤ªé›£ï¼Œå¯ä»¥æ”¾å¯¬è¦å‰‡ï¼Œåªè¦æ˜¯ã€Œè©èªã€å°±å¯ä»¥ï¼Œç”šè‡³å¯ä»¥ç©ã€Œé£Ÿç‰©æ¥é¾ã€è¶Šç©è¶Šé¤“ï¼',
    rules: [
      'ç¬¬ä¸€ä½ç©å®¶èªªå‡ºä¸€å¥å››å­—æˆèª (å¦‚ï¼šæ–°å¹´å¿«æ¨‚)ã€‚',
      'ä¸‹ä¸€ä½ç©å®¶å¿…é ˆç”¨æœ€å¾Œä¸€å€‹å­— (æ¨‚) ç•¶é–‹é ­æ¥æ–°çš„æˆèª (å¦‚ï¼šæ¨‚ä¸æ€èœ€)ã€‚',
      'æ¥ä¸å‡ºä¾†æˆ–æ€è€ƒè¶…é 5 ç§’è€…æ·˜æ±°æˆ–æ¥å—æ‡²ç½° (å”±æ­Œæˆ–èªªç¬‘è©±)ã€‚',
      'å …æŒåˆ°æœ€å¾Œçš„äººç²å‹ã€‚'
    ],
    tool: 'timer' // å•Ÿç”¨å€’æ•¸è¨ˆæ™‚
  },
  {
    id: 7,
    title: 'ğŸµ å“¼æ­ŒçŒœåå¤§è³½',
    players: '2äººä»¥ä¸Š',
    difficulty: 2,
    difficultyLabel: 'æ°£æ°›æ“”ç•¶',
    tags: ['éŸ³æ¨‚', 'æ‡·èˆŠé‡‘æ›²', 'è¶…å—¨'],
    mode: ['traffic'],
    description: 'ä¸éœ€è¦çœ‹æ‰‹æ©Ÿï¼å‡ºé¡Œè€…åªèƒ½ç”¨ã€Œå“¼ã€çš„ï¼ˆä¸èƒ½å”±å‡ºæ­Œè©ï¼‰å“¼ä¸€æ®µæ—‹å¾‹ï¼Œå…¶ä»–äººçŒœæ­Œåã€‚',
    tips: 'é§•é§›ä¹Ÿå¯ä»¥ç•¶å‡ºé¡Œè€…ï¼ˆå› ç‚ºåªéœ€è¦å“¼æ­Œï¼‰ï¼Œèƒ½æœ‰æ•ˆé˜²æ­¢é§•é§›æƒ³ç¡è¦ºå–”ï¼',
    rules: [
      'å‡ºé¡Œè€…é¸ä¸€é¦–æ­Œï¼Œåªèƒ½ç”¨ã€Œå“¼ã€çš„æ—‹å¾‹ï¼Œä¸èƒ½å”±å‡ºæ­Œè©ã€‚',
      'å…¶ä»–ç©å®¶çŒœæ­Œåæˆ–æ­Œæ‰‹ã€‚',
      'çŒœå°çš„äººæˆç‚ºä¸‹ä¸€ä½å‡ºé¡Œè€…ã€‚'
    ],
    tool: 'scoreboard'
  },
  {
    id: 8,
    title: 'ğŸ¤« æŒ‡å°–çµ‚æ¥µå¯†ç¢¼',
    players: '2-5äºº',
    difficulty: 2,
    difficultyLabel: 'ç„¡è²åˆºæ¿€',
    tags: ['çµ•å°å®‰éœ', 'å¿ƒç†æˆ°', 'å…é“å…·'],
    mode: ['transport', 'home'],
    description: 'ç¶“å…¸éŠæˆ²çš„ã€ŒéœéŸ³ç‰ˆã€ã€‚å…¨ç¨‹ç¦æ­¢èªªè©±ï¼Œçœ‹èª°å…ˆå¿ä¸ä½ç¬‘å ´ç™¼å‡ºè²éŸ³å°±è¼¸äº†ï¼',
    tips: 'é©åˆåœ¨é«˜éµ/ç«è»Šä¸Šç©ï¼Œå®Œå…¨ä¸æœƒåµåˆ°åˆ¥äººã€‚',
    rules: [
      'èŠå®¶åœ¨å¿ƒè£¡æƒ³ä¸€å€‹ 1-100 çš„æ•¸å­—ã€‚',
      'ç©å®¶è¼ªæµç”¨ã€Œæ‰‹å‹¢ã€æ¯”å‡ºæ•¸å­—çŒœæ¸¬ã€‚',
      'èŠå®¶åªèƒ½ç”¨æ‰‹å‹¢å›æ‡‰ç¯„åœï¼šå‘ä¸ŠæŒ‡(æ›´å¤§)ã€å‘ä¸‹æŒ‡(æ›´å°)ã€‚',
      'çŒœä¸­å¯†ç¢¼çš„äººè¼¸æ‰éŠæˆ²ï¼'
    ],
    tool: 'none'
  },
  {
    id: 9,
    title: 'ğŸ“± å‚™å¿˜éŒ„æ•…äº‹æ¥é¾',
    players: '2äººä»¥ä¸Š',
    difficulty: 3,
    difficultyLabel: 'å‰µæ„ç„¡é™',
    tags: ['å‚³éæ‰‹æ©Ÿ', 'è…¦æ´å¤§é–‹', 'æ–‡å­—éŠæˆ²'],
    mode: ['transport'],
    description: 'æ‰“é–‹æ‰‹æ©Ÿå‚™å¿˜éŒ„ï¼Œä¸€äººä¸€å¥ï¼Œå¯«å‡ºæœ€è’è¬¬çš„æ•…äº‹ã€‚',
    tips: 'é«˜éµä¸Šè¨Šè™Ÿä¸å¥½ä¹Ÿæ²’é—œä¿‚ï¼Œå› ç‚ºæ˜¯ç”¨æœ¬æ©Ÿå‚™å¿˜éŒ„ç©ï¼',
    rules: [
      'é–‹å•Ÿæ‰‹æ©Ÿå‚™å¿˜éŒ„ï¼Œç¬¬ä¸€äººåœ¨ç¬¬ä¸€è¡Œå¯«ä¸‹ä¸€å¥é–‹é ­ (ä¾‹å¦‚ï¼šé™¤å¤•å¤œï¼Œå¤–æ˜Ÿäººé™è½åœ¨é˜¿å¬¤å®¶...)ã€‚',
      'å°‡æ‰‹æ©Ÿå‚³çµ¦ä¸‹ä¸€ä½ï¼Œä»–åœ¨ç¬¬äºŒè¡ŒçºŒå¯«ä¸€å¥ï¼Œä»¥æ­¤é¡æ¨ã€‚',
      'å‚³å®Œä¸€è¼ªæˆ–å¤§å®¶å¯«ç´¯äº†ï¼Œç”±æœ€å¾Œä¸€å€‹äººæœ—è®€å®Œæ•´æ•…äº‹ã€‚'
    ],
    tool: 'none'
  },
  {
    id: 4,
    title: 'ğŸ¨ æ­ªæ¨“å‚³æƒ…ç•«æ„',
    players: '5-8äºº',
    difficulty: 2,
    difficultyLabel: 'ç¹ªç•«ç™½ç—´å‹å–„',
    tags: ['ç•«åœ–æ¥é¾', 'å‰µæ„ç„¡é™', 'æ¡ŒéŠ'],
    mode: ['home', 'transport'],
    description: 'é¡ä¼¼ã€Œç•«åœ–ç‰ˆçš„å‚³è²ç­’ã€ã€‚ç•«å¾—è¶Šé†œåè€Œè¶Šå¥½ç©ï¼',
    tips: 'åœ¨å¤§çœ¾é‹è¼¸ä¸Šç©ï¼Œè¨˜å¾—æº–å‚™ç¡¬æ¿ç´™ç­†ï¼Œä¸”å‚³éæ™‚å‹•ä½œè¦è¼•ï¼Œé¿å…æ‰“æ“¾é„°åº§ã€‚',
    rules: [
      'æ¯äººä¸€æœ¬ç´™/ç•«æ¿ã€‚ç¬¬ä¸€é å¯«ä¸‹é¡Œç›® (å¦‚ï¼šèˆé¾èˆç…)ã€‚',
      'å‚³çµ¦ä¸‹ä¸€ä½ï¼Œä»–çœ‹é¡Œç›®å¾Œï¼Œåœ¨ç¬¬äºŒé ç•«å‡ºä¾†ã€‚',
      'å†å‚³çµ¦ä¸‹ä¸€ä½ï¼Œä»–çœ‹åœ–çŒœæ˜¯ä»€éº¼ï¼Œå¯«åœ¨ç¬¬ä¸‰é æ–‡å­—ã€‚',
      'é‡è¤‡ã€Œæ–‡å­— -> åœ– -> æ–‡å­—ã€ç›´åˆ°å‚³å›æœ¬äººï¼Œä¸€èµ·æª¢è¨æ˜¯èª°ç•«æ­ªäº†ï¼'
    ],
    tool: 'none'
  },
  {
    id: 2,
    title: 'ğŸƒ åˆºæ¿€å°„é¾é–€',
    players: '4-12äºº',
    difficulty: 1,
    difficultyLabel: 'ç°¡å–®å¥½ä¸Šæ‰‹',
    tags: ['å¿ƒè·³åŠ é€Ÿ', 'æ’²å…‹ç‰Œ', 'è©¦è©¦æ‰‹æ°£'],
    mode: ['home'],
    description: 'éå¹´æœ€å—æ­¡è¿çš„æ’²å…‹ç‰ŒéŠæˆ²ï¼è¦å‰‡æ¥µåº¦ç°¡å–®å»åˆºæ¿€ç„¡æ¯”ã€‚',
    tips: 'å¯ä½¿ç”¨ç±Œç¢¼æˆ–ç³–æœä»£æ›¿é›¶éŒ¢ï¼Œå®‰å…¨åˆå¥½ç©ã€‚',
    rules: [
      'ç™¼çµ¦ç©å®¶å…©å¼µç‰Œï¼Œç¿»é–‹ã€‚',
      'ç©å®¶åˆ¤æ–·ç¬¬ä¸‰å¼µç‰Œæ˜¯å¦æœƒä»‹æ–¼é€™å…©å¼µç‰Œä¹‹é–“ (å°„é–€)ã€‚',
      'å¦‚æœè¦ºå¾—æœƒï¼Œå–Šæ³¨ä¸¦ç™¼ç¬¬ä¸‰å¼µç‰Œã€‚',
      'ä»‹æ–¼ä¸­é–“ -> è´èµ°æ³¨é‡‘ï¼›æ’æŸ±(èˆ‡å‰å…©å¼µåŒé») -> è³ å…©å€ï¼›ç•Œå¤– -> è³ ä¸€å€ã€‚'
    ],
    tool: 'scoreboard'
  },
  {
    id: 3,
    title: 'ğŸ­ çˆ†ç¬‘æ¯”æ‰‹ç•«è…³',
    players: '4-20äºº (é©åˆåˆ†çµ„)',
    difficulty: 3,
    difficultyLabel: 'è€ƒé©—é»˜å¥‘',
    tags: ['è‚¢é«”å–œåŠ‡', 'ç¬‘åˆ°è‚šå­ç—›', 'åœ˜éšŠåˆä½œ'],
    mode: ['home'],
    description: 'åªèƒ½ç”¨è‚¢é«”å‹•ä½œè¡¨é”é¡Œç›®ï¼Œçµ•å°ä¸èƒ½å‡ºè²ï¼',
    tips: 'é¡Œç›®å¯ä»¥è¨­å®šç‚ºã€Œæ–°å¹´å‰ç¥¥è©±ã€ã€ã€ŒçŸ¥åé›»å½±ã€æˆ–ã€Œå®¶æ—æˆå“¡ç‰¹å¾µã€ã€‚',
    rules: [
      'åˆ†æˆå…©éšŠï¼Œæ¯éšŠè¼ªæµæ´¾ä¸€äººä¸Šå°æ¯”åŠƒã€‚',
      'å‡ºé¡Œè€…çœ‹é¡Œç›®å¾Œï¼Œç”¨è‚¢é«”èªè¨€è¡¨é”ï¼Œä¸å¯èªªè©±æˆ–ç™¼å‡ºè²éŸ³ã€‚',
      'éšŠå‹åœ¨é™æ™‚å…§çŒœå‡ºç­”æ¡ˆï¼ŒçŒœå°æœ€å¤šé¡Œçš„éšŠä¼ç²å‹ã€‚'
    ],
    tool: 'timer'
  },
  {
    id: 5,
    title: 'ğŸƒâ€â™‚ï¸ æ”¯æ´å‰ç·š',
    players: '6äººä»¥ä¸Š (é©åˆåˆ†çµ„)',
    difficulty: 4,
    difficultyLabel: 'é«”åŠ›æ´»',
    tags: ['å…¨å®¶å‹•èµ·ä¾†', 'æ»¿å±‹å­è·‘', 'æ°£æ°›å—¨ç‚¸'],
    mode: ['home'],
    description: 'ä¸»æŒäººå–Šå‡ºéœ€è¦çš„ç‰©å“ï¼Œæœ€å¿«æ¹Šé½Šçš„éšŠä¼ç²å‹ã€‚',
    tips: 'è¨˜å¾—æŠŠæ˜“ç¢ç‰©å“æ”¶å¥½ï¼Œä¸¦æé†’å¤§å®¶åœ¨å®¢å»³å¥”è·‘æ™‚æ³¨æ„å®‰å…¨ã€‚',
    rules: [
      'é¸ä¸€ä½ä¸»æŒäººï¼Œå…¶ä»–äººåˆ†çµ„ã€‚',
      'ä¸»æŒäººå–Šå‡ºé¡Œç›®ï¼š(ä¾‹å¦‚ï¼šæˆ‘è¦ä¸‰æ”¯æ‰‹éŒ¶ã€ä¸€æ¢ç´…çš®å¸¶ï¼)ã€‚',
      'å„çµ„éšŠå“¡é¦¬ä¸Šæœé›†ç‰©å“æ”¾åˆ°å‰æ–¹æ¡Œä¸Šã€‚',
      'æœ€å¿«æ¹Šé½Šä¸”æ­£ç¢ºçš„éšŠä¼å¾—åˆ†ã€‚'
    ],
    tool: 'scoreboard'
  }
];

// --- å°å·¥å…·å…ƒä»¶ ---

// ç°¡å–®è¨ˆæ™‚å™¨
const GameTimer = () => {
  const [seconds, setSeconds] = useState(60);
  const [isActive, setIsActive] = useState(false);

  useEffect(() => {
    let interval = null;
    if (isActive && seconds > 0) {
      interval = setInterval(() => {
        setSeconds(seconds => seconds - 1);
      }, 1000);
    } else if (seconds === 0) {
      setIsActive(false);
    }
    return () => clearInterval(interval);
  }, [isActive, seconds]);

  const resetTimer = () => {
    setIsActive(false);
    setSeconds(60);
  };

  return (
    <div className="bg-gray-100 p-4 rounded-xl flex flex-col items-center space-y-3 w-full">
      <div className="text-gray-500 font-bold text-sm flex items-center gap-2">
        <Clock className="w-4 h-4" /> éŠæˆ²å€’æ•¸
      </div>
      <div className={`text-4xl font-mono font-bold ${seconds < 10 ? 'text-red-500' : 'text-gray-800'}`}>
        {seconds}s
      </div>
      <div className="flex gap-2 w-full">
        <button 
          onClick={() => setIsActive(!isActive)}
          className={`flex-1 py-2 rounded-lg font-bold text-white transition-colors ${isActive ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-green-500 hover:bg-green-600'}`}
        >
          {isActive ? 'æš«åœ' : 'é–‹å§‹è¨ˆæ™‚'}
        </button>
        <button 
          onClick={resetTimer}
          className="px-4 py-2 bg-gray-300 hover:bg-gray-400 text-gray-700 rounded-lg font-bold"
        >
          é‡ç½®
        </button>
      </div>
    </div>
  );
};

// ç°¡å–®è¨ˆåˆ†æ¿
const ScoreBoard = () => {
  const [scores, setScores] = useState({ A: 0, B: 0 });

  const adjustScore = (team, delta) => {
    setScores(prev => ({ ...prev, [team]: Math.max(0, prev[team] + delta) }));
  };

  return (
    <div className="bg-gray-100 p-4 rounded-xl flex flex-col items-center space-y-3 w-full">
      <div className="text-gray-500 font-bold text-sm flex items-center gap-2">
        <Trophy className="w-4 h-4" /> ç°¡æ˜“è¨ˆåˆ†
      </div>
      <div className="flex justify-around w-full gap-4">
        {['A', 'B'].map(team => (
          <div key={team} className="flex flex-col items-center bg-white p-3 rounded-lg shadow-sm flex-1">
            <span className="text-gray-500 font-bold mb-1">{team} éšŠ/äºº</span>
            <span className="text-3xl font-bold text-indigo-600 mb-2">{scores[team]}</span>
            <div className="flex gap-2">
              <button onClick={() => adjustScore(team, -1)} className="w-8 h-8 rounded-full bg-red-100 text-red-600 font-bold hover:bg-red-200">-</button>
              <button onClick={() => adjustScore(team, 1)} className="w-8 h-8 rounded-full bg-green-100 text-green-600 font-bold hover:bg-green-200">+</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// æ¸²æŸ“æ˜Ÿæ˜Ÿé›£åº¦
const DifficultyStars = ({ level, colorClass }) => {
  const stars = [];
  for (let i = 1; i <= 5; i++) {
    if (i <= level) {
      stars.push(<Star key={i} className={`w-4 h-4 fill-current ${colorClass}`} />);
    } else {
      stars.push(<Star key={i} className="w-4 h-4 text-gray-200" />);
    }
  }
  return <div className="flex space-x-1">{stars}</div>;
};

// éŠæˆ²è©³æƒ… Modal
const GameModal = ({ game, onClose, colorConfig }) => {
  if (!game) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200">
      <div className="bg-white rounded-2xl w-full max-w-lg shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
        {/* Header */}
        <div className={`${colorConfig.headerBg} p-4 text-white flex justify-between items-center shrink-0`}>
          <h3 className="text-xl font-bold flex items-center gap-2">
             {game.title}
          </h3>
          <button onClick={onClose} className="p-1 hover:bg-white/20 rounded-full transition-colors">
            <X className="w-6 h-6" />
          </button>
        </div>

        {/* Scrollable Content */}
        <div className="p-6 overflow-y-auto">
          {/* Tags */}
          <div className="flex flex-wrap gap-2 mb-4">
            {game.tags.map(tag => (
              <span key={tag} className={`px-2 py-1 text-xs rounded-md font-medium ${colorConfig.tagBg}`}>
                #{tag}
              </span>
            ))}
          </div>

          <p className="text-gray-600 mb-6 leading-relaxed">
            {game.description}
          </p>

          {/* Rules Section */}
          <div className="mb-6">
            <h4 className={`text-lg font-bold mb-3 flex items-center gap-2 ${colorConfig.text}`}>
              <CheckCircle2 className="w-5 h-5" /> éŠæˆ²è¦å‰‡
            </h4>
            <div className="space-y-3">
              {game.rules.map((rule, idx) => (
                <div key={idx} className="flex gap-3">
                  <span className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white ${colorConfig.headerBg}`}>
                    {idx + 1}
                  </span>
                  <p className="text-gray-700 text-sm">{rule}</p>
                </div>
              ))}
            </div>
          </div>

          {/* Tools Section */}
          {game.tool !== 'none' && (
            <div className="mb-6">
              <h4 className={`text-lg font-bold mb-3 flex items-center gap-2 ${colorConfig.text}`}>
                <Play className="w-5 h-5" /> éŠæˆ²å°å¹«æ‰‹
              </h4>
              {game.tool === 'timer' && <GameTimer />}
              {game.tool === 'scoreboard' && <ScoreBoard />}
            </div>
          )}

          {/* Tips Box */}
          <div className={`border-l-4 p-3 rounded-r-lg text-sm ${colorConfig.tipBox}`}>
            <strong>ğŸ’¡ ç©æ³•å°æç¤ºï¼š</strong> {game.tips}
          </div>
        </div>

        {/* Footer Action */}
        <div className="p-4 border-t bg-gray-50 shrink-0">
          <button 
            onClick={onClose}
            className={`w-full py-3 rounded-xl font-bold text-white shadow-md transition-transform active:scale-95 ${colorConfig.buttonPrimary}`}
          >
            äº†è§£ï¼Œé–‹å§‹ç©å§ï¼
          </button>
        </div>
      </div>
    </div>
  );
};

export default function App() {
  const [currentMode, setCurrentMode] = useState('home');
  const [activeFilter, setActiveFilter] = useState('å…¨éƒ¨');
  const [selectedGame, setSelectedGame] = useState(null); // æ§åˆ¶ Modal é¡¯ç¤º

  const filters = ['å…¨éƒ¨', 'ç°¡å–®å¥½ä¸Šæ‰‹', 'è¼•é¬†å‹•è…¦', 'è€ƒé©—é»˜å¥‘', 'é«”åŠ›æ´»'];

  const getModeConfig = (mode) => {
    switch(mode) {
      case 'traffic':
        return {
          bg: 'bg-blue-50',
          text: 'text-slate-800',
          headerBg: 'bg-indigo-600',
          accent: 'text-indigo-600',
          cardBorder: 'border-indigo-100 hover:border-indigo-400',
          buttonPrimary: 'bg-indigo-600 hover:bg-indigo-700',
          buttonLight: 'bg-indigo-50 text-indigo-800',
          tagBg: 'bg-indigo-100 text-indigo-800',
          starColor: 'text-yellow-400',
          icon: <Car className="w-8 h-8 text-yellow-300" />,
          title: 'åœ‹é“å¡è»Šæ•‘æ´æŒ‡å—',
          desc: 'å¡è»Šä¸ç„¡èŠï¼ç²¾é¸ã€Œå…é“å…·ã€è½è¦ºç³»ã€éŠæˆ²ï¼Œé§•é§›ä¹Ÿèƒ½é–‹å¿ƒåƒèˆ‡ï¼Œæç¥åˆæœ‰è¶£ï¼',
          footer: 'ç¥å¤§å®¶ è¡Œè»Šå¹³å®‰ï¼Œå¡è»Šä¸ç…©èºï¼',
          filterButtonActive: 'bg-indigo-500 text-white',
          tipBox: 'bg-blue-50 border-blue-400 text-blue-900'
        };
      case 'transport':
        return {
          bg: 'bg-emerald-50',
          text: 'text-emerald-900',
          headerBg: 'bg-emerald-600',
          accent: 'text-emerald-600',
          cardBorder: 'border-emerald-100 hover:border-emerald-400',
          buttonPrimary: 'bg-emerald-600 hover:bg-emerald-700',
          buttonLight: 'bg-emerald-50 text-emerald-800',
          tagBg: 'bg-emerald-100 text-emerald-800',
          starColor: 'text-yellow-400',
          icon: <TrainFront className="w-8 h-8 text-white" />,
          title: 'é«˜éµ/ç«è»Š å®‰éœéŠæˆ²å€',
          desc: 'å˜˜ï¼é€™è£¡æœ‰é©åˆã€Œä½éŸ³é‡ã€ä¸æ‰“æ“¾é„°åº§ã€çš„éŠæˆ²ï¼Œè®“æ¼«é•·çš„è»Šç¨‹è®Šæˆæœ‰è¶£çš„æ™‚å…‰ã€‚',
          footer: 'ç¥å¤§å®¶ æ—…é€”æ„‰å¿«ï¼Œæº–æ™‚æŠµé”ï¼',
          filterButtonActive: 'bg-emerald-500 text-white',
          tipBox: 'bg-teal-50 border-teal-400 text-teal-900'
        };
      default: // home
        return {
          bg: 'bg-orange-50',
          text: 'text-red-900',
          headerBg: 'bg-red-600',
          accent: 'text-red-600',
          cardBorder: 'border-transparent hover:border-yellow-400',
          buttonPrimary: 'bg-red-600 hover:bg-red-700',
          buttonLight: 'bg-red-50 text-red-800',
          tagBg: 'bg-orange-100 text-orange-800',
          starColor: 'text-yellow-400',
          icon: <Sparkles className="w-8 h-8 text-yellow-300" />,
          title: 'è¿æ˜¥ç´ç¦ åœ˜åœ“éŠæˆ²',
          desc: 'åƒå®Œå¹´å¤œé£¯ä¸çŸ¥é“è¦å¹¹å˜›ï¼Ÿç²¾é¸æœ€é©åˆå…¨å®¶å¤§å°çš„éŠæˆ²ï¼Œå¾é˜¿å…¬é˜¿å¬¤åˆ°å°å­¸å§ªå­éƒ½èƒ½å—¨ç¿»å¤©ï¼',
          footer: 'ç¥å¤§å®¶ æ–°å¹´å¿«æ¨‚ï¼Œé—”å®¶å¹³å®‰ï¼Œé¦¬å¹´è¡Œå¤§é‹ï¼',
          filterButtonActive: 'bg-red-500 text-white',
          tipBox: 'bg-yellow-50 border-yellow-400 text-yellow-900'
        };
    }
  };

  const config = getModeConfig(currentMode);

  let filteredGames = games.filter(game => game.mode.includes(currentMode));
  
  if (currentMode === 'home' && activeFilter !== 'å…¨éƒ¨') {
     filteredGames = filteredGames.filter(game => game.difficultyLabel === activeFilter);
  }

  return (
    <div className={`min-h-screen font-sans pb-12 transition-colors duration-500 ${config.bg} ${config.text}`}>
      
      {/* éŠæˆ²è©³æƒ… Modal */}
      {selectedGame && (
        <GameModal 
          game={selectedGame} 
          colorConfig={config} 
          onClose={() => setSelectedGame(null)} 
        />
      )}

      {/* é ‚éƒ¨æ©«å¹… */}
      <header className={`py-12 px-4 shadow-lg relative overflow-hidden transition-colors duration-500 ${config.headerBg}`}>
        <div className="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
          {currentMode === 'traffic' && (
             <>
               <Car className="w-64 h-64 absolute -top-10 -right-10 rotate-12 text-white" />
               <Car className="w-48 h-48 absolute -bottom-10 -left-10 -rotate-12 text-white" />
             </>
          )}
          {currentMode === 'transport' && (
             <>
               <TrainFront className="w-64 h-64 absolute -top-10 -right-10 rotate-12 text-white" />
               <Coffee className="w-32 h-32 absolute bottom-5 left-10 text-white" />
             </>
          )}
          {currentMode === 'home' && (
             <>
               <div className="text-9xl absolute -top-10 -left-10 rotate-12 text-white">ç¦</div>
               <div className="text-9xl absolute -bottom-10 -right-10 -rotate-12 text-white">æ˜¥</div>
             </>
          )}
        </div>
        
        <div className="max-w-4xl mx-auto text-center relative z-10 text-white">
          <div className="flex flex-col items-center">
            <div className="flex justify-center items-center space-x-3 mb-2">
              {config.icon}
              <h1 className="text-3xl md:text-5xl font-bold tracking-wider text-white drop-shadow-md">
                {config.title}
              </h1>
              {config.icon}
            </div>
            {/* æ–°å¢å‰¯æ¨™é¡Œ */}
            <p className="text-yellow-200 font-medium text-lg tracking-widest drop-shadow-sm opacity-90">
              By AIè¦ªå­æˆé•·å±‹
            </p>
          </div>
          <p className="text-lg md:text-xl max-w-2xl mx-auto mt-4 leading-relaxed opacity-90">
            {config.desc}
          </p>
        </div>
      </header>

      {/* å ´æ™¯åˆ‡æ›æ§åˆ¶å€ */}
      <div className="max-w-4xl mx-auto px-4 mt-8 mb-6">
        <div className="flex flex-col md:flex-row justify-center gap-4 mb-6">
          <button
            onClick={() => { setCurrentMode('home'); setActiveFilter('å…¨éƒ¨'); }}
            className={`flex-1 py-3 px-4 rounded-xl flex items-center justify-center space-x-2 transition-all shadow-sm ${
              currentMode === 'home' ? 'bg-red-600 text-white ring-2 ring-red-300 shadow-md transform scale-105' : 'bg-white text-gray-500 hover:bg-red-50'
            }`}
          >
            <PartyPopper className="w-5 h-5" />
            <span className="font-bold">ğŸ  åœ¨å®¶åœ˜åœ“</span>
          </button>
          
          <button
            onClick={() => { setCurrentMode('traffic'); setActiveFilter('å…¨éƒ¨'); }}
            className={`flex-1 py-3 px-4 rounded-xl flex items-center justify-center space-x-2 transition-all shadow-sm ${
              currentMode === 'traffic' ? 'bg-indigo-600 text-white ring-2 ring-indigo-300 shadow-md transform scale-105' : 'bg-white text-gray-500 hover:bg-indigo-50'
            }`}
          >
            <Car className="w-5 h-5" />
            <span className="font-bold">ğŸš— å¡è»Šæ•‘æ´</span>
          </button>

          <button
            onClick={() => { setCurrentMode('transport'); setActiveFilter('å…¨éƒ¨'); }}
            className={`flex-1 py-3 px-4 rounded-xl flex items-center justify-center space-x-2 transition-all shadow-sm ${
              currentMode === 'transport' ? 'bg-emerald-600 text-white ring-2 ring-emerald-300 shadow-md transform scale-105' : 'bg-white text-gray-500 hover:bg-emerald-50'
            }`}
          >
            <TrainFront className="w-5 h-5" />
            <span className="font-bold">ğŸš„ å®‰éœè»Šå»‚</span>
          </button>
        </div>

        {currentMode === 'home' && (
          <div className="flex flex-col md:flex-row items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-opacity-20">
            <div className="flex flex-wrap gap-2 justify-center w-full">
              <div className="flex items-center space-x-2 text-gray-700 font-bold mr-2">
                <Filter className="w-5 h-5" />
                <span className="hidden sm:inline">ç¯©é¸ï¼š</span>
              </div>
              {filters.map(filter => (
                <button
                  key={filter}
                  onClick={() => setActiveFilter(filter)}
                  className={`px-3 py-1.5 rounded-full text-sm font-medium transition-colors duration-200 ${
                    activeFilter === filter
                      ? config.filterButtonActive + ' shadow-md'
                      : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                  }`}
                >
                  {filter}
                </button>
              ))}
            </div>
          </div>
        )}
      </div>

      {/* éŠæˆ²åˆ—è¡¨ */}
      <div className="max-w-4xl mx-auto px-4 space-y-6">
        {filteredGames.map((game) => (
          <div 
            key={game.id} 
            className={`bg-white rounded-2xl p-6 shadow-md hover:shadow-xl transition-all duration-300 border-2 group relative overflow-hidden ${config.cardBorder}`}
          >
            {currentMode !== 'home' && (
              <div className={`absolute top-0 right-0 text-white text-xs font-bold px-3 py-1 rounded-bl-xl z-10 flex items-center gap-1 ${currentMode === 'traffic' ? 'bg-indigo-500' : 'bg-emerald-500'}`}>
                {currentMode === 'traffic' ? <Car className="w-3 h-3" /> : <TrainFront className="w-3 h-3" />}
                <span>{currentMode === 'traffic' ? 'å¡è»Šé©ç©' : 'å®‰éœé©ç©'}</span>
              </div>
            )}

            <div className="flex flex-col md:flex-row gap-6 pt-2">
              <div className="flex-1">
                <h2 className={`text-2xl font-bold mb-3 flex items-center ${config.accent}`}>
                  {game.title}
                </h2>
                
                <div className="flex flex-wrap gap-2 mb-4">
                  {game.tags.map(tag => (
                    <span 
                      key={tag} 
                      className={`px-2 py-1 text-xs rounded-md font-medium ${config.tagBg}`}
                    >
                      #{tag}
                    </span>
                  ))}
                </div>

                <p className="text-gray-700 leading-relaxed mb-4">
                  {game.description}
                </p>

                <div className={`border-l-4 p-3 rounded-r-lg text-sm ${config.tipBox}`}>
                  <strong>ğŸ’¡ ç©æ³•å°æç¤ºï¼š</strong> {game.tips}
                </div>
              </div>

              <div className={`md:w-64 rounded-xl p-4 flex flex-col justify-center space-y-4 ${config.buttonLight}`}>
                <div className="flex items-center space-x-3 text-gray-700">
                  <div className="bg-white p-2 rounded-full shadow-sm">
                    <Users className={`w-5 h-5 ${config.accent}`} />
                  </div>
                  <div>
                    <div className="text-xs font-bold opacity-60">é©åˆäººæ•¸</div>
                    <div className="font-semibold">{game.players}</div>
                  </div>
                </div>

                <div className="flex items-center space-x-3 text-gray-700">
                  <div className="bg-white p-2 rounded-full shadow-sm">
                    <StarHalf className="w-5 h-5 text-yellow-500" />
                  </div>
                  <div>
                    <div className="text-xs font-bold opacity-60">é›£æ˜“åº¦</div>
                    <div className="flex items-center space-x-2">
                      <DifficultyStars level={game.difficulty} colorClass={config.starColor} />
                    </div>
                    <div className="text-xs text-gray-500 mt-1">({game.difficultyLabel})</div>
                  </div>
                </div>
                
                <button 
                  onClick={() => setSelectedGame(game)}
                  className={`mt-2 w-full flex items-center justify-center space-x-1 text-white py-2 rounded-lg transition-colors font-medium ${config.buttonPrimary}`}
                >
                  <span>{currentMode !== 'home' ? 'çœ‹è©³ç´°è¦å‰‡' : 'æº–å‚™é–‹ç©'}</span>
                  <ChevronRight className="w-4 h-4" />
                </button>
              </div>
            </div>
          </div>
        ))}
      </div>

      <footer className={`text-center mt-12 pb-8 transition-colors ${config.text}`}>
        <p className="font-bold text-lg mb-6">{config.footer}</p>
        
        {/* æ–°å¢ï¼šç¤¾ç¾¤æŒ‰éˆ•èˆ‡ç‰ˆæ¬Šè²æ˜ */}
        <div className="flex flex-col items-center gap-4">
          <div className="flex gap-4">
            <a href="#" className={`p-3 rounded-full ${config.buttonLight} hover:opacity-80 transition-opacity transform hover:scale-110`}>
              <Facebook className="w-5 h-5" />
            </a>
            <a href="#" className={`p-3 rounded-full ${config.buttonLight} hover:opacity-80 transition-opacity transform hover:scale-110`}>
              <Instagram className="w-5 h-5" />
            </a>
            <a href="#" className={`p-3 rounded-full ${config.buttonLight} hover:opacity-80 transition-opacity transform hover:scale-110`}>
              <Youtube className="w-5 h-5" />
            </a>
          </div>
          
          <div className="text-xs opacity-60 mt-2 font-medium">
            <p>AIè¦ªå­æˆé•·å±‹ Â© {new Date().getFullYear()} All Rights Reserved.</p>
          </div>
        </div>
      </footer>
    </div>
  );

}
